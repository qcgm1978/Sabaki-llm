# MCP 集成使用指南

本文档介绍如何在 Sabaki 中使用 MCP (Model Context Protocol) 功能，实现 LLM 与
KataGo 的智能协作。

## 功能概述

MCP 集成功能允许您在 AI 聊天界面中：

- 直接使用 KataGo 进行棋盘分析
- 配置分析参数，获取详细的围棋分析结果
- 通过自然语言与 AI 助手交流，让 AI 利用 KataGo 工具进行专业分析

## 启动 AI 聊天界面

1. 打开 Sabaki 应用
2. 从菜单栏选择 **窗口 > AI 聊天** 或使用快捷键
3. AI 聊天抽屉将从右侧滑出

## 使用 MCP 工具

### 手动使用 KataGo 工具

1. 在 AI 聊天界面中，点击顶部的 **工具** 按钮，展开 MCP 工具面板
2. 从工具列表中选择您需要的 KataGo 分析功能，例如：
   - `katago_analysis`: 全面分析当前棋局
   - `katago_score`: 估算当前局面得分
3. 根据需要配置工具参数（如分析深度、搜索时间等）
4. 点击 **执行** 按钮运行分析
5. 分析结果将显示在聊天界面中

### 通过 AI 使用 KataGo 工具

1. 在聊天输入框中用自然语言提出问题，例如：
   - "分析当前棋局，找出最佳走法"
   - "这里黑棋的形势如何？"
   - "白棋应该如何应对？"
2. AI 助手会自动识别您的需求并调用相应的 KataGo 工具
3. 工具执行结果会被 AI 助手处理后，以自然语言方式呈现给您

## 支持的 KataGo 工具

### katago_analysis

**功能**：对当前棋局进行全面分析，包括最佳走法、胜率评估等。

**参数**：

- `komi`: 贴目值（可选）
- `includePolicy`: 是否包含策略数据（可选）
- `maxVisits`: 最大访问次数（可选，控制分析深度）

### katago_score

**功能**：估算当前局面的得分。

**参数**：无

## 示例使用场景

### 场景 1：分析对局

1. 打开一个 SGF 文件或创建新棋局
2. 将棋盘移动到您想要分析的位置
3. 在 AI 聊天中输入："分析当前局面的关键要点"
4. AI 会调用 KataGo 分析工具，并以自然语言总结分析结果

### 场景 2：学习战术

1. 在棋盘上摆出一个战术局面
2. 在 AI 聊天中输入："这个局面有什么常见的战术手段？"
3. AI 会分析局面并解释可能的战术选择

### 场景 3：复盘辅助

1. 在复盘中遇到困惑的一手棋
2. 在 AI 聊天中输入："这一手的意图是什么？有没有更好的选择？"
3. AI 会分析该手棋及其替代方案

## 配置 KataGo 引擎

要使用 MCP 功能，您需要先正确配置 KataGo 引擎。请按照以下步骤操作：

1. **下载 KataGo 引擎**：

   - 访问
     [KataGo GitHub 发布页面](https://github.com/lightvector/KataGo/releases) 下
     载适合您操作系统的最新版本
   - 确保同时下载预训练模型文件（通常是 .txt.gz 格式）

2. **配置 Sabaki 中的 KataGo 引擎**：

   - 打开 Sabaki 应用
   - 从菜单栏选择 **编辑 > 首选项** 或使用快捷键
   - 在首选项窗口中，选择左侧的 "引擎" 选项卡
   - 点击 "添加引擎" 按钮
   - 填写以下信息：
     - **名称**：KataGo（或其他您喜欢的名称）
     - **命令**：浏览并选择您下载的 KataGo 可执行文件
     - **参数**：添加以下参数（根据您的实际文件路径调整）：
       ```
       gtp -model /path/to/model.txt.gz -config /path/to/gtp_example.cfg
       ```
   - 点击 "确定" 保存引擎配置

3. **测试引擎连接**：
   - 配置完成后，可以通过在 AI 聊天界面尝试执行一个简单的 KataGo 工具来测试连接
   - 如果连接成功，您将看到分析结果
   - 如果连接失败，请检查文件路径和参数是否正确

## 注意事项

1. 确保您已正确配置 KataGo 引擎路径（按照上面的步骤）
2. 分析结果的质量取决于 KataGo 引擎的配置和性能
3. 复杂分析可能需要一些时间，请耐心等待
4. 您可以通过调整参数来平衡分析深度和响应速度

## 故障排除

### 常见错误及解决方案

1. **"未配置 KataGo 引擎" 错误**

   - 确保已按照上面的配置指南正确设置 KataGo 引擎
   - 检查引擎路径和参数是否正确
   - 尝试重启 Sabaki 应用

2. **工具执行失败**

   - 验证 KataGo 引擎是否正确安装和配置
   - 检查模型文件和配置文件路径是否正确
   - 确认 KataGo 可执行文件有执行权限（在 macOS/Linux 上可能需要 `chmod +x` 命令
     ）

3. **分析结果异常或缺失**

   - 尝试调整参数，如增加 `maxVisits` 值以获得更深入的分析
   - 检查 KataGo 配置文件中的设置
   - 验证您使用的 KataGo 版本是否与模型文件兼容

4. **性能问题**
   - 对于大型棋局或深度分析，可能需要增加系统资源
   - 可以通过减少 `maxVisits` 值来加快分析速度

### 获取更多帮助

- 查看 Sabaki 的官方文档或社区支持渠道
- 检查 KataGo GitHub 仓库中的文档和问题讨论
- 确保您使用的是最新版本的 Sabaki 和 KataGo
